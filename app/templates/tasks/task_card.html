{% macro task_card(task) %}
<a href="{{ url_for('tasks.task_details', slug_or_id=task.slug) }}" class="text-decoration-none">
    <div class="card mb-2 kanban-task" data-task-id="{{ task.id }}">
        <div class="card-body p-2">
            <!-- En-tête avec titre et priorité -->
            <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="card-title mb-0 text-truncate kanban-task-title" style="max-width: 250px;" title="{{ task.title }}">
                    {{ task.title }}
                </h6>
                <div class="d-flex align-items-center gap-1">
                    <span class="badge bg-{{ task.priority }} ms-2 flex-shrink-0" style="margin-top: 0.25rem;">
                        <i class="fas fa-flag me-1"></i>{{ task.priority }}
                    </span>
                {% if task.status == 'terminé' and not task.is_archived %}
                <button type="button" class="btn btn-sm btn-outline-secondary p-1 archive-task-btn" 
                        data-task-id="{{ task.id }}" 
                        data-task-title="{{ task.title }}" 
                        data-task-slug="{{ task.slug }}"
                        title="Archiver la tâche" 
                        style="font-size: 0.7rem;">
                    <i class="fas fa-archive"></i>
                </button>
                {% endif %}
                </div>
            </div>

            <!-- Description -->
            {% if task.description %}
            <div class="task-description mb-2">
                <p class="mb-0 task-description-text" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                    {{ task.description }}
                </p>
            </div>
            {% endif %}

            <!-- Informations de temps et assignation -->
            <div class="task-meta d-flex flex-wrap gap-1 align-items-center justify-content-end">
                <span class="badge bg-light text-dark" title="Récurrence">
                    <i class="fas fa-repeat me-1"></i>{% if task.recurrence_series_id %}Récurrente{% else %}Aucune{% endif %}
                </span>
                {% if task.estimated_time %}
                    <span class="badge bg-info" title="Temps estimé">
                        <i class="fas fa-clock me-1"></i>{{ task.estimated_time|format_time }}
                    </span>
                {% endif %}
                {% if task.actual_time %}
                    <span class="badge bg-success" title="Temps passé">
                        <i class="fas fa-hourglass-half me-1"></i>{{ task.actual_time|format_time }}
                    </span>
                {% endif %}
                {% if task.user_id %}
                    <span class="badge bg-secondary" title="Assigné à">
                        <i class="fas fa-user me-1"></i>{{ task.assigned_to.name }}
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</a>
{% endmacro %} 